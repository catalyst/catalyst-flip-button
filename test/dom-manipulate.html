<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Polyfills -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/@webcomponents/shadycss/custom-style-interface.min.js"></script>

  <!-- Web Tester -->
  <script src="../node_modules/web-component-tester/browser.js"></script>

  <!-- Element -->
  <script src="../dist/catalyst-flip-button.js"></script>
</head>
<body>

  <test-fixture id="basic">
    <template>
      <catalyst-flip-button>
        <div slot="options" id="id1" value="a">Apples</div>
        <div slot="options" id="id2" value="b">Banana</div>
        <div slot="options" id="id3" value="c">Carrot</div>
        <div slot="options" id="id4" value="d">Duck</div>
      </catalyst-flip-button>
    </template>
  </test-fixture>

  <script>
    /**
     * Basics suite.
     */
    suite('', () => {
      let element;

      /**
       * Called before each following test is run.
       */
      setup(() => {
        element = fixture('basic');
      });

      /**
       * Adding.
       */
      suite('Adding', () => {

        // Test the `add()` method.
        test('add()', () => {
          let newOption = document.createElement('option');
          newOption.id = 'id5';
          newOption.value = 'e';
          newOption.textContent = 'Egg';

          element.add(newOption);

          expect(element.length).to.equal(5);
          expect(element.options.length).to.equal(5);
          expect(element.selectedIndex).to.equal(0);

          element.selectedIndex = 4;

          expect(element.selectedIndex).to.equal(4);
          expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
          expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;
        });

        // Test the directly editiing the light dom.
        test('Light Dom Manipulation', () => {
          let newOption = document.createElement('option');
          newOption.id = 'id5';
          newOption.slot = 'options';
          newOption.value = 'e';
          newOption.textContent = 'Egg';

          element.appendChild(newOption);

          expect(element.length).to.equal(5);
          expect(element.options.length).to.equal(5);
          expect(element.selectedIndex).to.equal(0);

          element.selectedIndex = 4;

          expect(element.selectedIndex).to.equal(4);
          expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
          expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;
        });
      });

      /**
       * Removing.
       */
       suite('Removing', () => {

        suite('Remove Non-Active Element', () => {
          // Test the `remove()` method.
          test('remove()', (done) => {
            let testRunning = true;

            element.remove(1);

            setTimeout(() => {
              if (testRunning) {
                expect(element.length).to.equal(3);
                expect(element.options.length).to.equal(3);
                expect(element.selectedIndex).to.equal(0);

                element.selectedIndex = 1;

                expect(element.selectedIndex).to.equal(1);
                expect(element.options[element.selectedIndex].id).to.equal('id3');

                testRunning = false;
                done();
              }
            }, 10);
          });

          // Test the directly editiing the light dom.
          test('Light Dom Manipulation', (done) => {
            let testRunning = true;

            let option = element.querySelector('#id2');

            element.removeChild(option);

            setTimeout(() => {
              if (testRunning) {
                expect(element.length).to.equal(3);
                expect(element.options.length).to.equal(3);
                expect(element.selectedIndex).to.equal(0);

                element.selectedIndex = 1;

                expect(element.selectedIndex).to.equal(1);
                expect(element.options[element.selectedIndex].id).to.equal('id3');

                testRunning = false;
                done();
              }
            }, 10);
          });
        });

        suite('Remove Active Element', () => {
          suite('Non-Last Element', () => {
            // Test the `remove()` method.
            test('remove()', (done) => {
              let testRunning = true;

              element.remove(0);

              setTimeout(() => {
                if (testRunning) {
                  expect(element.length).to.equal(3);
                  expect(element.options.length).to.equal(3);
                  expect(element.selectedIndex).to.equal(0);
                  expect(element.options[element.selectedIndex].id).to.equal('id2');
                  expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
                  expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;
                  expect(element.getAttribute('aria-activedescendant')).to.equal('id2');

                  testRunning = false;
                  done();
                }
              }, 10);
            });

            // Test the directly editiing the light dom.
            test('Light Dom Manipulation', (done) => {
              let testRunning = true;

              let option = element.querySelector('#id1');

              element.removeChild(option);

              setTimeout(() => {
                if (testRunning) {
                  expect(element.length).to.equal(3);
                  expect(element.options.length).to.equal(3);
                  expect(element.selectedIndex).to.equal(0);
                  expect(element.options[element.selectedIndex].id).to.equal('id2');
                  expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
                  expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;
                  expect(element.getAttribute('aria-activedescendant')).to.equal('id2');

                  testRunning = false;
                  done();
                }
              }, 10);
            });
          });

          suite('Last Element', () => {
            // Test the `remove()` method.
            test('remove()', (done) => {
              let testRunning = true;

              element.selectedIndex = 3;
              element.remove(3);

              setTimeout(() => {
                if (testRunning) {
                  expect(element.length).to.equal(3);
                  expect(element.options.length).to.equal(3);
                  expect(element.selectedIndex).to.equal(2);
                  expect(element.options[element.selectedIndex].id).to.equal('id3');
                  expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
                  expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;

                  testRunning = false;
                  done();
                }
              }, 10);
            });

            // Test the directly editiing the light dom.
            test('Light Dom Manipulation', (done) => {
              let testRunning = true;

              let option = element.querySelector('#id4');

              element.selectedIndex = 3;
              element.removeChild(option);

              setTimeout(() => {
                if (testRunning) {
                  expect(element.length).to.equal(3);
                  expect(element.options.length).to.equal(3);
                  expect(element.selectedIndex).to.equal(2);
                  expect(element.options[element.selectedIndex].id).to.equal('id3');
                  expect(element.options[element.selectedIndex].classList.contains('active')).to.be.true;
                  expect(element.options[element.selectedIndex].hasAttribute('hidden')).to.be.false;

                  testRunning = false;
                  done();
                }
              }, 10);
            });
          });
        });
      });
    });
  </script>
</body>
</html>
