<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <!-- Polyfills -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/@webcomponents/shadycss/custom-style-interface.min.js"></script>

  <!-- Web Tester -->
  <script src="../node_modules/web-component-tester/browser.js"></script>

  <!-- Element -->
  <script src="../dist/catalyst-flip-button.js"></script>
</head>
<body>

  <test-fixture id="basic">
    <template>
      <catalyst-flip-button>
        <select>
          <option id="id1" value="a">Apples</option>
          <option id="id2" value="b">Banana</option>
          <option id="id3" value="c">Carrot</option>
          <option id="id4" value="d">Duck</option>
        </select>
      </catalyst-flip-button>
    </template>
  </test-fixture>

  <script>
    /**
     * Basics suite.
     */
    suite('', () => {
      let element;
      let select;

      /**
       * Called before each following test is run.
       */
      setup(() => {
        element = fixture('basic');
        select = element.querySelector('select');
      });

      /**
       * Adding.
       */
      suite('Adding', () => {

        // Test the `add()` method.
        test('select.add()', () => {
          let newOption = document.createElement('option');
          newOption.id = 'id5';
          newOption.value = 'e';
          newOption.textContent = 'Egg';

          select.add(newOption);

          expect(select.length).to.equal(5);
          expect(select.options.length).to.equal(5);
          expect(select.selectedIndex).to.equal(0);

          select.selectedIndex = 4;
          expect(select.selectedIndex).to.equal(4);
        });

        // Test the directly editiing the light dom.
        test('Light Dom Manipulation', () => {
          let newOption = document.createElement('option');
          newOption.id = 'id5';
          newOption.slot = 'options';
          newOption.value = 'e';
          newOption.textContent = 'Egg';

          select.appendChild(newOption);

          expect(select.length).to.equal(5);
          expect(select.options.length).to.equal(5);
          expect(select.selectedIndex).to.equal(0);

          select.selectedIndex = 4;
          expect(select.selectedIndex).to.equal(4);
        });
      });

      /**
       * Removing.
       */
       suite('Removing', () => {

        suite('Remove Non-Active Element', () => {
          // Test the `remove()` method.
          test('select.remove()', (done) => {
            let testRunning = true;

            select.remove(1);

            setTimeout(() => {
              if (testRunning) {
                expect(select.length).to.equal(3);
                expect(select.options.length).to.equal(3);
                expect(select.selectedIndex).to.equal(0);

                select.selectedIndex = 1;

                expect(select.selectedIndex).to.equal(1);
                expect(select.options[select.selectedIndex].id).to.equal('id3');

                testRunning = false;
                done();
              }
            }, 10);
          });

          // Test the directly editiing the light dom.
          test('Light Dom Manipulation', (done) => {
            let testRunning = true;

            let option = select.querySelector('#id2');

            select.removeChild(option);

            setTimeout(() => {
              if (testRunning) {
                expect(select.length).to.equal(3);
                expect(select.options.length).to.equal(3);
                expect(select.selectedIndex).to.equal(0);

                select.selectedIndex = 1;

                expect(select.selectedIndex).to.equal(1);
                expect(select.options[select.selectedIndex].id).to.equal('id3');

                testRunning = false;
                done();
              }
            }, 10);
          });
        });

        suite('Remove Active Element', () => {
          suite('Non-Last Element', () => {
            // Test the `remove()` method.
            test('select.remove()', (done) => {
              let testRunning = true;

              select.remove(0);

              setTimeout(() => {
                if (testRunning) {
                  expect(select.length).to.equal(3);
                  expect(select.options.length).to.equal(3);
                  expect(select.selectedIndex).to.equal(0);
                  expect(select.options[select.selectedIndex].id).to.equal('id2');

                  testRunning = false;
                  done();
                }
              }, 10);
            });

            // Test the directly editiing the light dom.
            test('Light Dom Manipulation', (done) => {
              let testRunning = true;

              let option = select.querySelector('#id1');

              select.removeChild(option);

              setTimeout(() => {
                if (testRunning) {
                  expect(select.length).to.equal(3);
                  expect(select.options.length).to.equal(3);
                  expect(select.selectedIndex).to.equal(0);
                  expect(select.options[select.selectedIndex].id).to.equal('id2');

                  testRunning = false;
                  done();
                }
              }, 10);
            });
          });

          suite('Last Element', () => {
            // Test the `remove()` method.
            test('select.remove()', (done) => {
              let testRunning = true;

              select.selectedIndex = 3;
              select.remove(3);

              setTimeout(() => {
                if (testRunning) {
                  expect(select.length).to.equal(3);
                  expect(select.options.length).to.equal(3);
                  expect(select.selectedIndex).to.equal(0);
                  expect(select.options[select.selectedIndex].id).to.equal('id1');

                  testRunning = false;
                  done();
                }
              }, 10);
            });

            // Test the directly editiing the light dom.
            test('Light Dom Manipulation', (done) => {
              let testRunning = true;

              let option = select.querySelector('#id4');

              select.selectedIndex = 3;
              select.removeChild(option);

              setTimeout(() => {
                if (testRunning) {
                  expect(select.length).to.equal(3);
                  expect(select.options.length).to.equal(3);
                  expect(select.selectedIndex).to.equal(0);
                  expect(select.options[select.selectedIndex].id).to.equal('id1');

                  testRunning = false;
                  done();
                }
              }, 10);
            });
          });
        });
      });
    });
  </script>
</body>
</html>
